<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Data Visualization</title>
    <!-- Add Leaflet and Chart.js libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <style>
        #mapPopup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background-color: white;
            padding: 10px;
            border: 1px solid #ccc;
            box-shadow: 0px 0px 10px #ccc;
			width: 600px;
			height: 500px;
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <h1>Weather Data Visualization</h1>
    <button id="showMapButton">Show Map</button>

    <div id="overlay"></div>
    <div id="mapPopup">
        <div id="map" style="width: 100%; height: 400px;"></div>
        <button id="closeMapButton">Close Map</button>
    </div>

    <h2 id="chartTitle"></h2>
    <canvas id="weatherChart" width="400" height="200"></canvas>

    <script>
        let map;
let marker;
let chart;

// Function to initialize the map and marker
function initializeMap() {
    map = L.map('map').setView([55.6761, 12.5683], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
    }).addTo(map);

    map.on('click', function(e) {
        marker.setLatLng(e.latlng);
        fetchDataAndDrawChart(e.latlng.lat, e.latlng.lng);
        closeMapPopup();
    });

    marker = L.marker([55.6761, 12.5683]).addTo(map);
}

// Function to fetch weather data from the API and update the chart
async function fetchDataAndDrawChart(lat, lon) {
    // API call and chart update logic goes here
}

// Function to open the map popup
function openMapPopup() {
    document.getElementById('mapPopup').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
    if (!map) {
        initializeMap();
    }
}

// Function to close the map popup
function closeMapPopup() {
    document.getElementById('mapPopup').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
}

// Event listeners for buttons
document.getElementById('showMapButton').addEventListener('click', openMapPopup);
document.getElementById('closeMapButton').addEventListener('click', closeMapPopup);
document.getElementById('overlay').addEventListener('click', closeMapPopup);

// Initialize Chart.js
const ctx = document.getElementById('weatherChart').getContext('2d');
chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Temperature (Â°C)',
            data: [],
            borderColor: 'rgba(75, 192, 192, 1)',
            fill: false
        }, {
            label: 'Precipitation',
            data: [],
            borderColor: 'rgba(255, 99, 132, 1)',
            fill: false
        }]
    },
    options: {
        scales: {
            x: {
                type: 'time',
                time: {
                    parser: 'luxon',
                    unit: 'hour'
                },
                title: {
                    display: true,
                    text: 'Time'
                }
            },
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Value'
                }
            }
        }
    }
});

    </script>
</body>
</html>
